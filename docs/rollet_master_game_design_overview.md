# Roll-et — Master Game Design Overview

## 1. Purpose & Scope
Roll-et is a PWA-based, offline-first dice game inspired by roulette, with a single d20 roll driving each round. 
This document consolidates all game rules, player flow, and contract definitions into a single design reference for development and auditing.

---

## 2. Game Flow

- **Round States:**
  1. **Join** — Players scan House QR and take a seat (max 4).
  2. **Betting** — Players place credits onto betting mat options.
  3. **Locked** — Bets freeze, Bet Certs issued.
  4. **Resolved** — House rolls d20, result recorded.
  5. **Settled** — Credits liquidated to winnings/losses → tender or BANK.

- **Betting Options:**
  - Single numbers → 18:1 payout.
  - Splits → 8:1 payout.
  - Quarters included.
  - No thirds, Lucky 7, or prime/composite bets.

---

## 3. Player Data

- **Fields (per player):**
  - `id` — pseudonymous Player UID. Appears in [Bet Certs](bet_certificate_contract.md), [BANK receipts](bank_receipt_contract.md), and all ledger entries (admissions, bets, settlements) in the [Ledger & Sync contract](ledger_sync_contract.md).
  - `name` — local display label only; not stored in Bet Certs, BANK receipts, or ledger entries.
  - `bets` — array of placed bet slips. Contents are hashed into Bet Certs and recorded in ledger bet entries; not included in BANK receipts.
  - `pool` — available credits for the current round. Tracked locally; buy-in is logged at admission but pool changes are not represented in Bet Certs or BANK receipts.
  - `bank` — cumulative stored credits from prior rounds. Updated when [BANK receipts](bank_receipt_contract.md) are issued or spent and reflected in ledger receipt entries.

- **Local statistics (`Stats`):**
  - `rounds` — count of rounds played locally. Mirrors ledger round totals but is not stored in artifacts.
  - `hits` — tally of d20 outcomes (indexes 1–20). Used for local analytics; round results are separately recorded in the ledger.
  - `banks` — mapping of `Player.id` to stored credits. Tracks BANK receipt balances and corresponds to ledger receipt issuance/spend events.

---

## 4. Credit Economy

- **Buy-in:** 4 credits per player per round.
- **Cap:** 8 credits maximum per round.
- **Valuation:** House sets credit value at round start (increments of $0.25, max $10.00).
- **Normalization Ceiling (Global Analytics):** $1,440 max per player per round (8 × 18:1 × $10).
- **Local Variance:** Houses may operate at any valuation within rules, but ledger sync always normalizes to $1,440 ceiling.
- **Settlement:** No carry-over of credits. Winnings = tender or BANK receipts.

---

## 5. Contracts

### 5.1 House Certificate
- License to host, default 28-day validity.
- Required for hosting, ledger sync, and issuing Join/Bet/BANK artifacts.
- Optional 12-month tier (10% discount under consideration).

### 5.2 Join Challenge/Response
- QR generated by House for each round.
- Contains House Cert + round binding + one-time nonce.
- Player scans → UID derived from Player + House → admission validated.
- Prevents replay/seat overflow.

### 5.3 Bet Certificate
- Issued post-lock.
- Contains Player UID, round ID, bet hash.
- Encrypted, short-lived, one-time proof of locked bet.
- Allows offline verification and read-only re-checks.

### 5.4 BANK Receipt
- Issued at settlement.
- Records net winnings.
- Portable, verifiable offline, one-time use.
- May be redeemed for re-buy or tender.

### 5.5 Ledger & Sync
- House maintains append-only, tamper-evident ledger.
- Periodic sync with backend required; gated by House Cert.
- Ledger entries: admissions, bets, certs, results, settlements.
- Global analytics normalized to $1,440/player/round.
- Immutable, auditable, Root-anchored.

---

## 6. Security Model

- **Offline trust:** Players require no internet after install; Houses sync periodically.
- **Integrity:** Bet hashes, receipt IDs, sequential ledger.
- **Replay Protection:** Nonces + one-time certs.
- **Privacy:** Player IDs pseudonymous; no PII or raw hardware fingerprints.
- **Auditability:** Backend ensures full traceability from Root Authority → House Cert → round artifacts.

---

## 7. Error & Recovery

- Invalid House Cert → Hosting blocked; player sees error + upgrade link.
- Expired Join QR → Player prompted to rescan.
- Over-capacity ( >4 seats) → Denied admission.
- Over-credit (>8) → Bet rejected.
- Expired Bet Cert → View-only renewal possible.
- Spent BANK receipt → Denied, user shown error.
- Broken ledger hash chain → Sync refused, flagged for operator.

---

## 8. Acceptance Criteria

- Valid House Certificate required for all rounds.
- Max 4 players per round.
- Credit buy-in and valuation rules strictly enforced.
- All artifacts verifiable offline.
- Global analytics respect $1,440 ceiling.
- Ledger synchronization only from certified Houses.
